{% assign section_id = section.id | replace: '_', '' | downcase %}

<div class="product product--template product--large product__info-wrapper" id="CollectionGalleryTabs-{{ section_id }}">
  <!-- Gallery -->
  {% assign gallery_images = collection.metafields.custom.product_images.value %}
  {% if gallery_images %}
    <div class="product__media-wrapper">
      {% for image in gallery_images %}
        <div
          class="product__media{% if forloop.first %} is-active{% endif %}"
          data-media-id="media-{{ forloop.index0 }}"
        >
          <img
            src="{{ image | file_url }}"
            alt="{{ collection.title | escape }}"
            class="product__media-image"
            id="media-{{ forloop.index0 }}"
            {% if forloop.first %}
              style="display:block"
            {% else %}
              style="display:none"
            {% endif %}
          >
        </div>
      {% endfor %}
      <div class="product__media-list">
        {% for image in gallery_images %}
          <button
            class="product__media-thumbnail{% if forloop.first %} is-active{% endif %}"
            type="button"
            data-media-id="media-{{ forloop.index0 }}"
          >
            <img src="{{ image | file_url }}" alt="Thumbnail" class="product__media-thumbnail-image">
          </button>
        {% endfor %}
      </div>
    </div>
  {% else %}
    <div class="product__media-wrapper">
      {{ 'product-1' | placeholder_svg_tag }}
    </div>
  {% endif %}

  <!-- Collapsible Tabs (Accordion) -->
  <div class="product__accordion">
    {% assign product_data = collection.metafields.custom.product_data %}
    {% if product_data %}
      {% for item in product_data %}
        <div class="product__accordion accordion" data-accordion>
          <details>
            <summary>
              <span>{{ item.title }}</span>
            </summary>
            <div class="accordion__content">
              {{ item.content }}
            </div>
          </details>
        </div>
      {% endfor %}
    {% else %}
      <div style="padding:20px;text-align:center;background:#f4f4f4;border-radius:8px;">No product data available</div>
    {% endif %}
  </div>
</div>

<script>
  // Only needed if your theme doesn't already handle gallery switching
  document
    .querySelectorAll('#CollectionGalleryTabs-{{ section_id }} .product__media-thumbnail')
    .forEach(function (btn) {
      btn.addEventListener('click', function () {
        var id = btn.getAttribute('data-media-id');
        document.querySelectorAll('#CollectionGalleryTabs-{{ section_id }} .product__media').forEach(function (media) {
          media.classList.toggle('is-active', media.getAttribute('data-media-id') === id);
          media.querySelector('img').style.display = media.classList.contains('is-active') ? 'block' : 'none';
        });
        document
          .querySelectorAll('#CollectionGalleryTabs-{{ section_id }} .product__media-thumbnail')
          .forEach(function (th) {
            th.classList.toggle('is-active', th === btn);
          });
      });
    });
</script>

{% schema %}
{
  "name": "CollectionDisplay",
  "settings": [],
  "presets": [
    {
      "name": "CollectionDisplay"
    }
  ]
}
{% endschema %}
