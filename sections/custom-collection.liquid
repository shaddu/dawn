{% stylesheet %}
  .collection-product-style {
    margin: 0 auto;
    max-width: 1200px;
    padding: 2rem 1rem;
  }
  .collection-product-style .grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 2rem;
  }
  .product__media-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }
  .product__media-thumbnails {
    display: flex;
    flex-wrap: wrap;
    margin-top: 1rem;
    gap: 0.5rem;
  }
  .product__media-thumbnail {
    width: 60px;
    height: 60px;
    cursor: pointer;
    border: 1px solid #ccc;
    padding: 2px;
    object-fit: cover;
  }
  .product__media {
    max-width: 100%;
    height: auto;
  }
  .media-modal {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.8);
    z-index: 9999;
    justify-content: center;
    align-items: center;
  }
  .media-modal.active {
    display: flex;
  }
  .media-modal__image {
    max-width: 90vw;
    max-height: 90vh;
  }
  .media-modal__toggle {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: none;
    border: none;
    color: white;
  }
{% endstylesheet %}

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const thumbnails = document.querySelectorAll('.product__media-thumbnail');
    const mediaItems = document.querySelectorAll('.product__media-item img');
    const modal = document.getElementById('MediaGalleryModal');
    const closeBtn = modal?.querySelector('#ModalClose');

    thumbnails.forEach((thumb, index) => {
      thumb.addEventListener('click', () => {
        mediaItems.forEach((img, i) => {
          img.closest('.product__media-item').classList.toggle('is-active', i === index);
        });
      });
    });

    document.querySelectorAll('.product__media-toggle').forEach((btn) => {
      btn.addEventListener('click', () => {
        const id = btn.dataset.mediaId;
        modal.querySelectorAll('img').forEach((img) => {
          img.hidden = img.dataset.mediaId !== id;
        });
        modal.classList.add('active');
        modal.focus();
      });
    });

    closeBtn?.addEventListener('click', () => {
      modal.classList.remove('active');
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        modal.classList.remove('active');
      }
    });
  });
</script>

<div class="collection-product-style">
  <div class="grid product grid--1-col-tablet grid--2-col-desktop">
    <!-- Image gallery (left column) -->
    <div class="product__media-wrapper">
      <div class="product__media-list">
        {% for media in collection.metafields.custom.product_images.value %}
          <div class="product__media-item {% if forloop.first %}is-active{% endif %}">
            <button
              type="button"
              class="product__media-toggle"
              data-media-id="media-{{ forloop.index }}"
              aria-controls="MediaGalleryModal"
              aria-label="Zoom image"
            >
              <img
                src="{{ media | image_url: width: 1200 }}"
                loading="lazy"
                width="{{ media.width }}"
                height="{{ media.height }}"
                alt="{{ media.alt | escape }}"
                class="product__media"
              >
            </button>
          </div>
        {% endfor %}
      </div>

      <!-- Thumbnails -->
      <div class="product__media-thumbnails">
        {% for media in collection.metafields.custom.product_images.value %}
          <img
            src="{{ media | image_url: width: 150 }}"
            width="60"
            height="60"
            alt="{{ media.alt | escape }}"
            class="product__media-thumbnail"
          >
        {% endfor %}
      </div>
    </div>

    <!-- Collapsible content (right column) -->
    <div class="product__info-wrapper">
      <div class="product__accordion">
        {% assign product_data = collection.metafields.custom.product_data.value %}
        {% if product_data %}
          {% for block in product_data %}
            <details class="accordion">
              <summary class="accordion__summary">
                <div class="accordion__title">
                  {{ block.title }}
                </div>
                <div class="accordion__icon">
                  {{ 'icon-caret.svg' | inline_asset_content }}
                </div>
              </summary>
              <div class="accordion__content rte">
                {{ block.content }}
              </div>
            </details>
          {% endfor %}
        {% endif %}
      </div>
    </div>
  </div>
</div>

<media-gallery-modal id="MediaGalleryModal" class="media-modal">
  <div class="media-modal__dialog" role="dialog" aria-label="Media gallery" aria-modal="true" tabindex="-1">
    <button id="ModalClose" type="button" class="media-modal__toggle">
      {{ 'icon-close.svg' | inline_asset_content }}
    </button>
    <div class="media-modal__content" role="document">
      {% for media in collection.metafields.custom.product_images %}
        <img
          src="{{ media | image_url: width: 2000 }}"
          alt="{{ media.alt | escape }}"
          class="media-modal__image"
          data-media-id="media-{{ forloop.index }}"
          hidden
        >
      {% endfor %}
    </div>
  </div>
</media-gallery-modal>

{% schema %}
{
  "name": "Custom collection",
  "tag": "section",
  "settings": [],
  "presets": [
    {
      "name": "Custom collection"
    }
  ]
}
{% endschema %}
